/* ── Base ────────────────────────────────────────────────────────────────── */

:root {
    --bg: #f5faff;
    --text: #000;
    --text-dim: #888;
    --panel-bg: #fafcff;
    --panel-border: #c8c8d8;
    --header-color: #3c78a0;
    --valid-color: #28b450;
    --hover-bg: #dcf0ff;
    --flash-bg: #fff0b4;
    --button-bg: #4682b4;
    --button-hover: #6495ed;
    --button-disabled: #c8c8c8;
    --scorecard-bg: #fafcff;
    --scorecard-border: #b4b4c8;
    --overlay-bg: rgba(0,0,0,0.7);
    --ai-choice-bg: #b4dcff;
}

.dark-mode {
    --bg: #1e2026;
    --text: #dcdce6;
    --text-dim: #5a5a64;
    --panel-bg: #2d3038;
    --panel-border: #464855;
    --header-color: #64aade;
    --valid-color: #28b450;
    --hover-bg: #323c50;
    --flash-bg: #786428;
    --button-bg: #326496;
    --button-hover: #4678b4;
    --button-disabled: #5a5a64;
    --scorecard-bg: #282a32;
    --scorecard-border: #464855;
    --overlay-bg: rgba(0,0,0,0.85);
    --ai-choice-bg: #283c5a;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
}

/* ── Connection banner ───────────────────────────────────────────────────── */

#connection-banner {
    position: fixed; top: 0; left: 0; width: 100%; z-index: 200;
    background: #e67e22; color: white; text-align: center;
    padding: 8px; font-weight: bold; font-size: 0.95em;
    animation: slide-down 0.3s ease-out;
}
#connection-banner.hidden { display: none; }

@keyframes slide-down {
    from { transform: translateY(-100%); }
    to { transform: translateY(0); }
}

/* ── Layout ──────────────────────────────────────────────────────────────── */

#app { max-width: 1000px; margin: 0 auto; padding: 10px 20px; }

#header { text-align: center; margin-bottom: 10px; }
#header h1 { font-size: 2.5em; color: var(--header-color); margin-bottom: 4px; }
#round-info { font-size: 1.1em; margin-bottom: 4px; }
#player-bar { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; }
.player-chip {
    padding: 4px 14px; border-radius: 6px; font-size: 0.9em;
    border: 2px solid; transition: all 0.2s;
}
.player-chip.active { color: white; }

#main { display: flex; gap: 20px; }

#dice-area { flex: 0 0 auto; min-width: 300px; }
#scorecard-area { flex: 1; }

#dice-container { display: flex; gap: 12px; justify-content: center; margin-bottom: 12px; }

#roll-btn {
    display: block; margin: 0 auto 10px; padding: 12px 40px; font-size: 1.2em;
    font-weight: bold; background: var(--button-bg); color: white; border: none;
    border-radius: 8px; cursor: pointer; transition: background 0.2s;
}
#roll-btn:hover:not(:disabled) { background: var(--button-hover); }
#roll-btn:disabled { background: var(--button-disabled); cursor: not-allowed; }

#roll-status { text-align: center; font-size: 1.1em; margin-bottom: 6px; }
#ai-reason { text-align: center; font-size: 0.9em; color: var(--text-dim); min-height: 20px; }

/* ── Turn log (multiplayer) ──────────────────────────────────────────────── */

#turn-log { margin-top: 12px; }
.turn-log-header { font-size: 0.85em; font-weight: bold; color: var(--header-color); margin-bottom: 4px; }
.turn-log-entry {
    font-size: 0.8em; padding: 3px 8px; margin-bottom: 2px;
    background: var(--panel-bg); border-radius: 4px;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.turn-log-player { font-weight: bold; }
.turn-log-rolls { color: var(--text-dim); }
.turn-log-score { font-weight: 500; }

/* ── Scorecard table ─────────────────────────────────────────────────────── */

#scorecard {
    width: 100%; border-collapse: collapse;
    background: var(--scorecard-bg); border-radius: 10px; overflow: hidden;
    border: 2px solid var(--scorecard-border);
}

#scorecard th {
    background: var(--header-color); color: white; padding: 8px 12px;
    text-align: left; font-size: 0.95em;
}

#scorecard td { padding: 6px 12px; border-bottom: 1px solid var(--panel-border); }

#scorecard tr.section-header td {
    font-weight: bold; color: var(--header-color); background: var(--panel-bg);
    padding: 8px 12px; font-size: 0.9em;
}

#scorecard tr.total-row td { font-weight: bold; padding: 8px 12px; }

#scorecard tr.category-row { cursor: pointer; transition: background 0.15s; }
#scorecard tr.category-row:hover { background: var(--hover-bg); }
#scorecard tr.category-row.selected { background: var(--hover-bg); font-weight: bold; }
#scorecard tr.category-row.filled { cursor: default; }
#scorecard tr.category-row.filled:hover { background: transparent; }

#scorecard tr.flash td { animation: flash 0.5s ease; }
#scorecard tr.ai-choice td { background: var(--ai-choice-bg); }

.score-potential { color: var(--valid-color); font-weight: 500; }
.score-zero { color: var(--text-dim); }
.score-filled { color: var(--text); }

@keyframes flash {
    0% { background: var(--flash-bg); }
    50% { background: transparent; }
    100% { background: var(--flash-bg); }
}

/* ── Overlays ────────────────────────────────────────────────────────────── */

.overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: var(--overlay-bg); display: flex; align-items: center;
    justify-content: center; z-index: 100;
}
.overlay.hidden { display: none; }

.overlay-panel {
    background: var(--panel-bg); border: 2px solid var(--panel-border);
    border-radius: 12px; padding: 24px 32px; max-width: 700px; width: 90%;
    max-height: 80vh; overflow-y: auto; color: var(--text);
}
.overlay-small { max-width: 400px; text-align: center; }

.overlay-panel h2 { color: var(--header-color); margin-bottom: 16px; }
.overlay-panel h3 { margin-bottom: 12px; }

.overlay-footer { color: var(--text-dim); margin-top: 16px; text-align: center; font-size: 0.9em; }

.controls-table { width: 100%; }
.controls-table td { padding: 4px 12px; }
.controls-table td:first-child { font-weight: bold; color: var(--header-color); width: 140px; }

.confirm-buttons { display: flex; gap: 12px; justify-content: center; margin-top: 12px; }
.confirm-buttons button {
    padding: 8px 24px; border: none; border-radius: 6px; font-size: 1em; cursor: pointer;
}
.confirm-buttons button:first-child { background: #e74c3c; color: white; }
.confirm-buttons button:last-child { background: #95a5a6; color: white; }

#play-again-btn {
    display: block; margin: 20px auto 0; padding: 12px 40px; font-size: 1.1em;
    font-weight: bold; background: var(--button-bg); color: white; border: none;
    border-radius: 8px; cursor: pointer;
}
#play-again-btn:hover { background: var(--button-hover); }

#gameover-content { text-align: center; }
#gameover-content .final-score { font-size: 1.8em; font-weight: bold; color: var(--header-color); }
#gameover-content .pct-optimal { font-size: 1.1em; margin-top: 8px; }
#gameover-content .winner { font-size: 1.4em; font-weight: bold; margin-bottom: 12px; }
#gameover-content table { margin: 12px auto; border-collapse: collapse; }
#gameover-content table td { padding: 4px 16px; }

/* ── Toolbar ─────────────────────────────────────────────────────────────── */

#toolbar {
    position: fixed; bottom: 10px; right: 10px;
    display: flex; gap: 6px; z-index: 50;
}
#toolbar button {
    width: 36px; height: 36px; border: 2px solid var(--panel-border);
    border-radius: 8px; background: var(--panel-bg); cursor: pointer;
    font-size: 16px; display: flex; align-items: center; justify-content: center;
}
#toolbar button:hover { background: var(--hover-bg); }

/* ── History overlay ─────────────────────────────────────────────────────── */

#history-filters { margin-bottom: 12px; display: flex; gap: 16px; }
#history-filters button {
    padding: 4px 12px; border: 1px solid var(--panel-border); border-radius: 4px;
    background: var(--panel-bg); cursor: pointer; color: var(--text);
}
#history-filters button:hover { background: var(--hover-bg); }

.history-table { width: 100%; border-collapse: collapse; }
.history-table th { text-align: left; padding: 4px 8px; color: var(--header-color); border-bottom: 1px solid var(--panel-border); }
.history-table td { padding: 4px 8px; }

/* ── Colorblind mode ─────────────────────────────────────────────────────── */

.colorblind .score-potential { color: #0064c8; }
.colorblind .die.held { border-color: #0078dc !important; }

/* ── Responsive ──────────────────────────────────────────────────────────── */

@media (max-width: 768px) {
    #main { flex-direction: column; }
    #dice-area { min-width: auto; }
    #dice-container { gap: 4px; flex-wrap: nowrap; }
    .die { width: 56px; height: 56px; flex-shrink: 1; min-width: 44px; }
    .die .dot { width: 8px; height: 8px; }
    .held-label { font-size: 9px !important; }
    #header h1 { font-size: 1.8em; }
    .overlay-panel { padding: 16px 20px; }
    #app { padding: 10px 6px; }
    .die-wrapper { min-width: 0; }
}
